<!doctype html><html><head><title>
Java Version Management on macOS | www.bendik.dev
</title><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://www.bendik.dev/tufte-dark.css rel=stylesheet><body><article><div class=page-back><a href=/>‚Üê Back</a></div><h1>Java Version Management on macOS</h1><p class=subtitle>January 30, 2021 ‚Äì 5 minute read<section><p>With the increased frequency of Java releases handling multiple versions on a single machine is more and more relevant. Solutions already exists, such as the widely used <a href=https://www.jenv.be>jenv</a> ‚Äì my goto tool for a long time. For a number of reasons, I recently decided to throw it out of my system and build a solution myself. The result is a few small functions which handles most of my needs.</p><span id=continue-reading></span><p><em>(Tldr; if you just want the code, <a href=https://www.bendik.dev/posts/java-version-management-on-macos/#a-solution>just scroll down</a>)</em><p>My biggest issue was the startup time on new shells. It‚Äôs a <a href=https://github.com/jenv/jenv/issues/148>known issue</a>, with several workarounds, but at least to me they all affect my startup time noticably. Now, I might be an impatient guy, I‚Äôll admit that, but I just can‚Äôt stand spending time on something that I feel should happen instantly.<p>My second biggest issue was the troubleshooting. I practically live in my terminal, so problems have a big effect on my productivity. For that reason (and others, I‚Äôm sure), I tend to like simple solutions. Fewer blows and whistles, fewer weird problems. Without going into too much detail, I feel that jenv has made a few weird decisions that has ended up with me spending precious time debugging and troublehooting. I am sure these decisions are made for good reasons, so no hard feelings there, but it aligns badly with my love for simplicity.<h2 id=requirements>Requirements</h2><p>So I implemented my own solution. Because as you know, the rational solution to spending too much time on a problem is spending even <em>more</em>. But hey, it resulted in me writing this blog post so I guess there‚Äôs that.<p>My needs are quite simple<ul><li>I want the <code>java</code> command always available<li>I want the ability to switch, locally, between versions when needed<li>Bonus: automatically switching version when entering a folder would be cool</ul><p>.. and I believe that‚Äôs about it. New versions can easily be downloaded with Homebrew. Changing the version globally would be nice, but is not strictly neccesary.<p>Now, macOS comes with a little known commandline tool called <code>java_home</code>. It is located at <code>/usr/libexec/java_home</code>, which is not on your <code>PATH</code> by default, so I guess it might be hard to find. Anyway, it knows Java. It knows your default version. It knows the other installed versions. But most importantly for us, you can hand it different filters and get a path to a valid Java home folder back.<p>Our solution is based around the <code>java_home</code> tool. Let‚Äôs see it!<h2 id=a-solution>A solution</h2><p>I keep this in my <code>.zshrc</code> file. I have <em>no</em> idea if this will work in Bash or some other shell ‚Äì it‚Äôs untested in everything but Zsh. Sorry ü§∑.<pre class=language-sh data-lang=sh style=background:#212121;color:#eeffff><code class=language-sh data-lang=sh><span style=font-style:italic;color:#4a4a4a># Extract version from release file in java folder
</span><span style=color:#82aaff>_java_version</span><span style=color:#89ddff>() {
</span><span style=color:#82aaff>    </span><span style=color:#c792ea>local </span><span>version_path</span><span style=color:#89ddff>=$</span><span>1
</span><span>    </span><span style=font-style:italic;color:#c792ea>if </span><span style=color:#82aaff>[[ </span><span style=color:#89ddff>-</span><span style=color:#f78c6c>f </span><span style=color:#89ddff>$</span><span>version_path</span><span style=color:#82aaff>/release ]]</span><span style=color:#89ddff>; </span><span style=font-style:italic;color:#c792ea>then
</span><span>        </span><span style=color:#82aaff>cat </span><span style=color:#89ddff>$</span><span>version_path</span><span style=color:#82aaff>/release </span><span style=color:#89ddff>| </span><span style=color:#82aaff>grep </span><span style=color:#89ddff>"</span><span style=color:#c3e88d>JAVA_VERSION=</span><span style=color:#89ddff>" | </span><span style=color:#82aaff>sed</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>E </span><span style=color:#89ddff>'</span><span style=color:#c3e88d>s/JAVA_VERSION=|\"//g</span><span style=color:#89ddff>'
</span><span>    </span><span style=font-style:italic;color:#c792ea>else
</span><span>        </span><span style=color:#82aaff>echo </span><span style=color:#89ddff>$</span><span>path
</span><span>    </span><span style=font-style:italic;color:#c792ea>fi
</span><span style=color:#89ddff>}
</span><span>
</span><span style=font-style:italic;color:#4a4a4a># List current version with "jdk", or change with "jdk 12"
</span><span style=color:#82aaff>jdk</span><span style=color:#89ddff>() {
</span><span style=color:#82aaff>    </span><span style=color:#c792ea>local </span><span>version</span><span style=color:#89ddff>=${</span><span>1</span><span style=color:#89ddff>:-""}
</span><span style=color:#82aaff>    </span><span style=color:#c792ea>local </span><span>silent</span><span style=color:#89ddff>=${</span><span>2</span><span style=color:#89ddff>:-</span><span style=color:#c3e88d>false</span><span style=color:#89ddff>}
</span><span>    </span><span style=font-style:italic;color:#c792ea>if </span><span style=color:#82aaff>[[ </span><span style=color:#89ddff>$</span><span>version </span><span style=color:#89ddff>= "" </span><span style=color:#82aaff>]]</span><span style=color:#89ddff>; </span><span style=font-style:italic;color:#c792ea>then
</span><span>        </span><span style=color:#82aaff>java</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>version
</span><span>    </span><span style=font-style:italic;color:#c792ea>else
</span><span style=color:#82aaff>        </span><span style=color:#c792ea>export </span><span>JAVA_HOME</span><span style=color:#89ddff>=$(</span><span style=color:#82aaff>/usr/libexec/java_home</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>v</span><span style=color:#89ddff>"$</span><span>version</span><span style=color:#89ddff>");
</span><span>        </span><span style=font-style:italic;color:#c792ea>if </span><span style=color:#82aaff>[[ </span><span style=color:#89ddff>$</span><span>silent </span><span style=color:#89ddff>=</span><span style=color:#82aaff> false ]]</span><span style=color:#89ddff>; </span><span style=font-style:italic;color:#c792ea>then
</span><span>            </span><span style=color:#82aaff>java</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>version
</span><span>        </span><span style=font-style:italic;color:#c792ea>fi
</span><span>    </span><span style=font-style:italic;color:#c792ea>fi
</span><span style=color:#89ddff>}
</span><span>
</span><span style=font-style:italic;color:#4a4a4a># List available versions, global version, and local version with "jdks"
</span><span style=color:#82aaff>jdks</span><span style=color:#89ddff>() {
</span><span>    </span><span style=color:#82aaff>echo </span><span style=color:#89ddff>"</span><span style=color:#c3e88d>Java versions</span><span style=color:#89ddff>"
</span><span>    </span><span style=color:#82aaff>/usr/libexec/java_home</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>V 2</span><span style=color:#89ddff>>&</span><span style=color:#f78c6c>1 </span><span style=color:#89ddff>| </span><span style=color:#82aaff>sed 1d </span><span style=color:#89ddff>| </span><span style=color:#82aaff>sed </span><span style=color:#89ddff>'</span><span style=color:#c3e88d>$d</span><span style=color:#89ddff>' | </span><span style=color:#82aaff>cut</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>d</span><span style=color:#82aaff>,</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>f1
</span><span>    </span><span style=color:#82aaff>echo </span><span style=color:#89ddff>"</span><span style=color:#c3e88d>Global: </span><span style=color:#89ddff>$(</span><span style=color:#82aaff>_java_version </span><span style=color:#89ddff>$(</span><span style=color:#82aaff>/usr/libexec/java_home</span><span style=color:#89ddff>))"
</span><span>    </span><span style=font-style:italic;color:#c792ea>if </span><span style=color:#82aaff>[[ </span><span style=color:#89ddff>! -</span><span style=color:#f78c6c>z </span><span style=color:#89ddff>$</span><span>JAVA_HOME </span><span style=color:#82aaff>]]</span><span style=color:#89ddff>; </span><span style=font-style:italic;color:#c792ea>then
</span><span>        </span><span style=color:#82aaff>echo </span><span style=color:#89ddff>"</span><span style=color:#c3e88d>Local:  </span><span style=color:#89ddff>$(</span><span style=color:#82aaff>_java_version </span><span style=color:#89ddff>$</span><span>JAVA_HOME</span><span style=color:#89ddff>)"
</span><span>    </span><span style=font-style:italic;color:#c792ea>fi
</span><span style=color:#89ddff>}
</span></code></pre><p>The usage is mostly there as a comment above each function, but to explain the workflow: list available versions on the system, along with current global and possibly local version with the command <code>jdks</code>. No arguments needed here. To list the active version in your current shell, use the command <code>jdk</code>. Use this last command together with a version number to change version locally: <code>jdk 1.8</code>¬†gives you Java 1.8, <code>jdk 12</code> gives you Java 12. You don‚Äôt need to be completely specific, <code>jdk 1.8</code> chooses 1.8.0_265 on my system, even though 1.8.0_151 is installed as well. I‚Äôm not fluid on the heuristics here, but it mostly seems to behave.<h2 id=bonus>Bonus</h2><p>One thing I have added later on is loading a Java version from a <code>.java-version</code> file. With the snippet below, if I visit a folder with a <code>.java-version</code>¬†file in it, the version is automatically changed. Could it be any easier? Yeah, I guess ‚Äì it could check recursively, but I haven‚Äôt bothered yet. That sounds like it could also slow down my shell as it would happen on every directory change, so there might be a trade off here. As of now, this fills my needs.<pre class=language-sh data-lang=sh style=background:#212121;color:#eeffff><code class=language-sh data-lang=sh><span style=font-style:italic;color:#4a4a4a># Put this in your .zshrc file as well
</span><span>
</span><span style=font-style:italic;color:#4a4a4a># Automatically change java version from .java-version file
</span><span style=color:#82aaff>autoload</span><span style=color:#89ddff> -</span><span style=color:#f78c6c>U</span><span style=color:#82aaff> add-zsh-hook
</span><span style=color:#82aaff>_jdk_autoload_hook</span><span style=color:#89ddff>() {
</span><span>    </span><span style=font-style:italic;color:#c792ea>if </span><span style=color:#82aaff>[[ </span><span style=color:#89ddff>-</span><span style=color:#f78c6c>f</span><span style=color:#82aaff> .java-version ]]</span><span style=color:#89ddff>; </span><span style=font-style:italic;color:#c792ea>then
</span><span>        </span><span style=color:#82aaff>jdk </span><span style=color:#89ddff>"$(</span><span style=color:#82aaff>cat .java-version</span><span style=color:#89ddff>)"</span><span style=color:#82aaff> true
</span><span>    </span><span style=font-style:italic;color:#c792ea>fi
</span><span style=color:#89ddff>}
</span><span>
</span><span style=color:#82aaff>add-zsh-hook chpwd _jdk_autoload_hook
</span></code></pre></section></article>